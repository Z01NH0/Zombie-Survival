<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Survival</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
            background: #000;
            color: #fff;
            cursor: crosshair;
        }
        
        #gameCanvas {
            display: block;
            background: #0a0a12;
            width: 100%;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            font-size: 12px;
            color: #ff5555;
            text-shadow: 2px 2px 0 #000;
        }
        
        .stat-bar {
            height: 20px;
            margin: 8px 0;
            border: 3px solid #333;
            background: #222;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        #healthBarFill {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #ff3333, #ff5555);
            transition: width 0.3s;
        }
        
        #staminaBarFill {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #55aaff, #77ccff);
            transition: width 0.3s;
        }
        
        #inventory {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #444;
            box-shadow: 0 0 15px rgba(0,0,0,0.8);
        }
        
        .inventory-slot {
            width: 60px;
            height: 60px;
            border: 3px solid #555;
            background: rgba(30, 30, 30, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 8px;
            position: relative;
            transition: all 0.2s;
        }
        
        .inventory-slot.active {
            border: 3px solid #ff5555;
            transform: scale(1.1);
            box-shadow: 0 0 15px #ff5555;
        }
        
        .slot-ammo {
            font-size: 10px;
            margin-top: 5px;
            color: #77ccff;
        }
        
        .cooldown-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
            color: #ffcc00;
            background: rgba(0,0,0,0.7);
            padding: 2px;
            border-radius: 3px;
        }
        
        #dayTime {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #ffcc55;
            text-shadow: 2px 2px 0 #000;
            background: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid #ffcc55;
        }
        
        #timeLeft {
            position: absolute;
            top: 50px;
            right: 10px;
            font-size: 14px;
            color: #ffcc55;
            text-shadow: 2px 2px 0 #000;
            background: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid #ffcc55;
        }
        
        #gameOverScreen, #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            text-align: center;
        }
        
        #gameOverScreen h1, #startScreen h1 {
            font-size: 48px;
            color: #ff5555;
            margin-bottom: 30px;
            font-family: 'Bungee', cursive;
            text-shadow: 5px 5px 0 #000;
            letter-spacing: 3px;
        }
        
        #startScreen h1 {
            color: #ffcc55;
            font-size: 64px;
            margin-bottom: 10px;
        }
        
        .screen-description {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.5;
        }
        
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: linear-gradient(to bottom, #ff5555, #cc0000);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            margin: 10px;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #880000;
            text-transform: uppercase;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #880000;
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #880000;
        }
        
        #controls {
            margin-top: 30px;
            color: #777;
            font-size: 12px;
            line-height: 2;
        }
        
        #bloodOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            z-index: 150;
            transition: opacity 0.3s;
        }
        
        #healEffect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            z-index: 151;
            background: radial-gradient(circle, rgba(0,255,0,0.5) 0%, rgba(0,255,0,0) 70%);
            transition: opacity 0.5s;
        }
        
        .night-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 30, 0.7);
            pointer-events: none;
            z-index: 120;
        }
        
        #shop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border: 3px solid #ffcc55;
            border-radius: 10px;
            z-index: 200;
            display: none;
            width: 500px;
        }
        
        #shop h2 {
            color: #ffcc55;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .shop-columns {
            display: flex;
            gap: 20px;
        }
        
        .shop-column {
            flex: 1;
        }
        
        .shop-column-title {
            color: #ffcc55;
            margin-bottom: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(50, 50, 50, 0.5);
            border-radius: 5px;
            font-size: 12px;
        }
        
        .shop-item button {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }
        
        #coins {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #ffcc55;
            text-shadow: 2px 2px 0 #000;
            background: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid #ffcc55;
            margin-top: 90px;
        }
        
        .grenade {
            position: absolute;
            width: 15px;
            height: 15px;
            background: red;
            border-radius: 50%;
            box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.7);
            z-index: 110;
        }
        
        .explosion {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,100,0,0.8) 0%, rgba(255,0,0,0) 70%);
            z-index: 110;
            pointer-events: none;
        }
        
        .boss-projectile {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff00ff 0%, #880088 100%);
            border-radius: 50%;
            z-index: 110;
            pointer-events: none;
        }
        
        #bossMessage {
            position: absolute;
            top: 50px;
            right: 10px;
            font-size: 14px;
            color: #ff5555;
            text-shadow: 2px 2px 0 #000;
            background: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid #ff5555;
            display: none;
        }
        
        .laser-beam {
            position: absolute;
            background: linear-gradient(to right, rgba(0, 255, 0, 0.3), rgba(0, 255, 0, 0.8));
            z-index: 110;
            pointer-events: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="bloodOverlay"></div>
    <div id="healEffect"></div>
    <div id="nightOverlay" class="night-overlay" style="display: none;"></div>
    
    <div id="ui">
        <div>SA√öDE: <span id="health">100</span>%</div>
        <div class="stat-bar"><div id="healthBarFill"></div></div>
        <div>ENERGIA: <span id="stamina">100</span>%</div>
        <div class="stat-bar"><div id="staminaBarFill"></div></div>
        <div>ZUMBIS: <span id="zombieCount">0</span></div>
        <div>DIA: <span id="day">1</span></div>
    </div>
    
    <div id="dayTime">‚òÄÔ∏è DIA</div>
    <div id="timeLeft">TEMPO: 15s</div>
    <div id="bossMessage">MATE-O PARA PROSSEGUIR</div>
    <div id="coins">MOEDAS: <span id="coinCount">0</span></div>
    
    <div id="inventory">
        <div class="inventory-slot active">üî™<div class="slot-ammo">-</div></div>
        <div class="inventory-slot">üî´<div class="slot-ammo">0</div></div>
        <div class="inventory-slot">üí•<div class="slot-ammo">0</div></div>
        <div class="inventory-slot">ü©π<div class="slot-ammo">0</div></div>
        <div class="inventory-slot">üß®<div class="slot-ammo">0</div></div>
    </div>
    
    <div id="shop">
        <h2>LOJA DE MELHORIAS</h2>
        <div class="shop-columns">
            <div class="shop-column">
                <div class="shop-column-title">ARSENAL</div>
                <div class="shop-item">
                    <span>+12 Muni√ß√£o Pistola (<span id="ammoPrice">12</span> moedas)</span>
                    <button id="buyAmmo">COMPRAR</button>
                </div>
                <div class="shop-item">
                    <span>+5 Muni√ß√£o Shotgun (<span id="shotgunAmmoPrice">25</span> moedas)</span>
                    <button id="buyShotgunAmmo">COMPRAR</button>
                </div>
                <div class="shop-item">
                    <span>Kit M√©dico (<span id="medkitPrice">8</span> moedas)</span>
                    <button id="buyMedkit">COMPRAR</button>
                </div>
                <div class="shop-item">
                    <span>2 Granadas (<span id="grenadesPrice">40</span> moedas)</span>
                    <button id="buyGrenades">COMPRAR</button>
                </div>
            </div>
            <div class="shop-column">
                <div class="shop-column-title">STATUS</div>
                <div class="shop-item">
                    <span>+10% Vida (<span id="healthPrice">20</span> moedas)</span>
                    <button id="buyHealth">COMPRAR</button>
                </div>
                <div class="shop-item">
                    <span>+10% Dano (<span id="damagePrice">15</span> moedas)</span>
                    <button id="buyDamage">COMPRAR</button>
                </div>
                <div class="shop-item">
                    <span>+10% Stamina (<span id="speedPrice">18</span> moedas)</span>
                    <button id="buySpeed">COMPRAR</button>
                </div>
            </div>
        </div>
        <button id="closeShop" style="width: 100%; margin-top: 15px;">FECHAR LOJA</button>
    </div>
    
    <div id="startScreen">
        <h1>ZOMBIE SURVIVAL</h1>
        <p class="screen-description">O apocalipse zumbi chegou. Sobreviva o m√°ximo que puder em um mundo hostil. Durante o dia, compre melhorias na loja. √Ä noite, enfrente hordas de zumbis cada vez maiores.</p>
        <button id="startButton">INICIAR SOBREVIV√äNCIA</button>
        <div id="controls">
            WASD: MOVER | SHIFT: CORRER | 1-5: TROCAR ARMA<br>
            CLIQUE: ATACAR | R: RECARREGAR 
        </div>
    </div>
    
    <div id="gameOverScreen" style="display: none;">
        <h1>FIM DE JOGO</h1>
        <p class="screen-description">Voc√™ sobreviveu <span id="survivedDays">0</span> dias no apocalipse zumbi.</p>
        <button id="restartButton">TENTAR NOVAMENTE</button>
    </div>
    
    <script>
        const config = {
            width: 1600,
            height: 900,
            playerSpeed: 3.5,
            zombieSpawnRate: 1500,
            nightDuration: 45000,
            dayDuration: 15000,
            mapTiles: 25,
            itemSpawnChance: 0.05,
            itemSpawnInterval: 2000,
            baseZombiesPerNight: 5,
            zombieIncreasePerDay: 2
        };
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = config.width;
        canvas.height = config.height;

        const gameState = {
            player: null,
            zombies: [],
            bullets: [],
            acidBullets: [],
            bossProjectiles: [],
            grenades: [],
            explosions: [],
            obstacles: [],
            items: [],
            isNight: false,
            day: 1,
            gameTime: 0,
            gameOver: false,
            inventory: [
                { type: 'knife', ammo: null },
                { type: 'pistol', ammo: 0 },
                { type: 'shotgun', ammo: 0 },
                { type: 'medkit', ammo: 0 },
                { type: 'grenade', ammo: 0 }
            ],
            selectedSlot: 0,
            map: [],
            bloodEffect: 0,
            attackCooldown: 0,
            knifeAngle: 0,
            isAttacking: false,
            coins: 0,
            playerDamageMultiplier: 1,
            zombiesToSpawn: 0,
            zombiesSpawned: 0,
            shopOpen: false,
            itemSpawnTimer: 0,
            bossSpawned: false,
            bossAlive: false,
            pistolCooldown: 0,
            shotgunCooldown: 0,
            laserRifleCooldown: 0,
            hasLaserRifle: false,
            shopPrices: {
                ammo: 12,
                shotgunAmmo: 25,
                medkit: 8,
                grenades: 40,
                health: 20,
                damage: 15,
                speed: 18
            }
        };

        // Sprites
        const sprites = {
            player: createPlayerSprite(),
            zombies: {
                normal: createZombieSprite('#8fbb6b'),
                runner: createZombieSprite('#c78f6b'),
                brute: createZombieSprite('#6b8fbb'),
                crawler: createZombieSprite('#6b8f6b'),
                toxic: createZombieSprite('#8fbb8f'),
                tank: createZombieSprite('#ff8800'),
                fast: createZombieSprite('#aa55ff'),
                spitter: createZombieSprite('#55aaff'),
                boss: createBossSprite()
            },
            items: {
                pistol: createItemSprite('üî´', '#ff5555'),
                shotgun: createItemSprite('üí•', '#ffaa00'),
                pistolAmmo: createItemSprite('üîπ', '#55aaff'),
                shotgunAmmo: createItemSprite('üî∏', '#ffaa55'),
                medkit: createItemSprite('ü©π', '#55ff55'),
                grenade: createItemSprite('üß®', '#ff55ff'),
                coin: createItemSprite('ü™ô', '#ffcc00'),
                laserRifle: createItemSprite('üîã', '#00ff00')
            },
            weapons: {
                pistol: createWeaponSprite('#777', '#ffcc55'),
                shotgun: createShotgunSprite(),
                knife: createKnifeSprite(),
                laserRifle: createLaserRifleSprite(),
                medkit: createMedkitSprite(),
                grenade: createGrenadeSprite()
            },
            terrain: {
                grass: createTerrainSprite('#3a5c3a'),
                road: createTerrainSprite('#555555'),
                water: createTerrainSprite('#3a5c8f'),
                building: createTerrainSprite('#8f3a3a')
            }
        };

        function createPlayerSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 50;
            canvas.height = 50;
            const ctx = canvas.getContext('2d');
            
            // Corpo
            ctx.fillStyle = '#55aaff';
            ctx.fillRect(10, 10, 30, 40);
            
            // Cabe√ßa
            ctx.fillStyle = '#ffccaa';
            ctx.beginPath();
            ctx.arc(25, 15, 10, 0, Math.PI * 2);
            ctx.fill();
            
            return canvas;
        }

        function createZombieSprite(color) {
            const canvas = document.createElement('canvas');
            canvas.width = 40;
            canvas.height = 40;
            const ctx = canvas.getContext('2d');
            
            // Corpo
            ctx.fillStyle = color;
            ctx.fillRect(5, 10, 30, 30);
            
            // Cabe√ßa
            ctx.fillStyle = '#8fbb6b';
            ctx.beginPath();
            ctx.arc(20, 15, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // Ferimentos
            ctx.fillStyle = '#a00';
            ctx.beginPath();
            ctx.arc(15, 12, 2, 0, Math.PI * 2);
            ctx.arc(25, 12, 3, 0, Math.PI * 2);
            ctx.fill();
            
            return canvas;
        }

        function createBossSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 80;
            const ctx = canvas.getContext('2d');
            
            // Corpo
            const gradient = ctx.createLinearGradient(0, 0, 80, 80);
            gradient.addColorStop(0, '#ff0000');
            gradient.addColorStop(0.5, '#880000');
            gradient.addColorStop(1, '#ff8800');
            ctx.fillStyle = gradient;
            ctx.fillRect(10, 20, 60, 60);
            
            // Cabe√ßa
            ctx.fillStyle = '#ff5555';
            ctx.beginPath();
            ctx.arc(40, 20, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // Olhos
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(30, 15, 5, 0, Math.PI * 2);
            ctx.arc(50, 15, 5, 0, Math.PI * 2);
            ctx.fill();
            
            // Chifres
            ctx.fillStyle = '#880000';
            ctx.beginPath();
            ctx.moveTo(25, 5);
            ctx.lineTo(15, 0);
            ctx.lineTo(25, 10);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(55, 5);
            ctx.lineTo(65, 0);
            ctx.lineTo(55, 10);
            ctx.fill();
            
            return canvas;
        }

        function createItemSprite(emoji, bgColor) {
            const canvas = document.createElement('canvas');
            canvas.width = 30;
            canvas.height = 30;
            const ctx = canvas.getContext('2d');
            
            // Fundo
            ctx.fillStyle = bgColor;
            ctx.beginPath();
            ctx.arc(15, 15, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // Emoji
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#fff';
            ctx.fillText(emoji, 15, 15);
            
            return canvas;
        }

        function createWeaponSprite(handleColor, barrelColor) {
            const canvas = document.createElement('canvas');
            canvas.width = 60;
            canvas.height = 20;
            const ctx = canvas.getContext('2d');
            
            // Coronha
            ctx.fillStyle = '#5a3a1a';
            ctx.fillRect(0, 5, 15, 10);
            
            // Empunhadura
            ctx.fillStyle = handleColor;
            ctx.fillRect(15, 5, 20, 10);
            
            // Cano
            ctx.fillStyle = barrelColor;
            ctx.fillRect(35, 7, 25, 6);
            
            return canvas;
        }

        function createShotgunSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 70;
            canvas.height = 25;
            const ctx = canvas.getContext('2d');
            
            // Coronha
            ctx.fillStyle = '#5a3a1a';
            ctx.fillRect(0, 5, 20, 15);
            
            // Empunhadura
            ctx.fillStyle = '#777';
            ctx.fillRect(20, 5, 25, 15);
            
            // Cano duplo
            ctx.fillStyle = '#ffaa00';
            ctx.fillRect(45, 5, 25, 6);
            ctx.fillRect(45, 14, 25, 6);
            
            return canvas;
        }

        function createKnifeSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 60;
            canvas.height = 20;
            const ctx = canvas.getContext('2d');
            
            // L√¢mina (agora apontando para a direita)
            ctx.fillStyle = '#aaa';
            ctx.beginPath();
            ctx.moveTo(20, 0);
            ctx.lineTo(60, 10);
            ctx.lineTo(20, 20);
            ctx.closePath();
            ctx.fill();
            
            // Cabo
            ctx.fillStyle = '#5a3a1a';
            ctx.fillRect(0, 5, 20, 10);
            
            return canvas;
        }

        function createLaserRifleSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 25;
            const ctx = canvas.getContext('2d');
            
            // Coronha
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 5, 25, 15);
            
            // Empunhadura
            ctx.fillStyle = '#555';
            ctx.fillRect(25, 5, 30, 15);
            
            // Cano
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(55, 7, 25, 5);
            
            // Detalhes futuristas
            ctx.fillStyle = '#00aa00';
            ctx.fillRect(50, 5, 5, 15);
            ctx.fillRect(60, 5, 5, 15);
            
            return canvas;
        }

        function createMedkitSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 40;
            canvas.height = 30;
            const ctx = canvas.getContext('2d');
            
            // Bolsa m√©dica
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(5, 5, 30, 20);
            
            // Cruz branca
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(15, 8, 10, 4);
            ctx.fillRect(18, 5, 4, 15);
            
            return canvas;
        }

        function createGrenadeSprite() {
            const canvas = document.createElement('canvas');
            canvas.width = 30;
            canvas.height = 30;
            const ctx = canvas.getContext('2d');
            
            // Corpo da granada
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(15, 15, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // Detalhes
            ctx.fillStyle = '#FF4500';
            ctx.fillRect(15, 5, 3, 20);
            ctx.fillRect(5, 15, 20, 3);
            
            return canvas;
        }

        function createTerrainSprite(color) {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = color;
            ctx.fillRect(0, 0, 64, 64);
            
            // Adiciona textura
            if (color !== '#555555') {
                ctx.strokeStyle = color === '#3a5c8f' ? '#2a4c7f' : '#2a4a2a';
                for (let i = 0; i < 10; i++) {
                    ctx.beginPath();
                    ctx.moveTo(Math.random() * 64, Math.random() * 64);
                    ctx.lineTo(Math.random() * 64, Math.random() * 64);
                    ctx.stroke();
                }
            }
            
            return canvas;
        }

        // Classe do Jogador
        class Player {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 40;
                this.speed = config.playerSpeed;
                this.health = 100;
                this.maxHealth = 100;
                this.stamina = 100;
                this.maxStamina = 100;
                this.direction = { x: 0, y: 0 };
                this.lastShot = 0;
                this.isRunning = false;
                this.angle = 0;
                this.knifeAngle = 0;
                this.isAttacking = false;
                this.damageMultiplier = 1;
            }

            update() {
                // Movimenta√ß√£o
                const speedMultiplier = this.isRunning ? (this.stamina > 0 ? 1.8 : 1) : 1;
                this.x += this.direction.x * this.speed * speedMultiplier;
                this.y += this.direction.y * this.speed * speedMultiplier;

                // Limites do mapa
                this.x = Math.max(0, Math.min(config.width - this.width, this.x));
                this.y = Math.max(0, Math.min(config.height - this.height, this.y));

                // Stamina
                if (this.isRunning) {
                    this.stamina -= 0.3;
                    if (this.stamina <= 0) {
                        this.stamina = 0;
                        this.isRunning = false;
                    }
                } else {
                    this.stamina += 0.15;
                    if (this.stamina > this.maxStamina) this.stamina = this.maxStamina;
                }

                // Atualiza UI
                document.getElementById('health').textContent = Math.floor(this.health);
                document.getElementById('healthBarFill').style.width = `${(this.health / this.maxHealth) * 100}%`;
                document.getElementById('stamina').textContent = Math.floor(this.stamina);
                document.getElementById('staminaBarFill').style.width = `${(this.stamina / this.maxStamina) * 100}%`;

                // Anima√ß√£o da faca
                if (this.isAttacking) {
                    this.knifeAngle += 0.3;
                    if (this.knifeAngle >= Math.PI) {
                        this.knifeAngle = 0;
                        this.isAttacking = false;
                    }
                }

                // Verifica colis√£o com itens
                for (let i = gameState.items.length - 1; i >= 0; i--) {
                    const item = gameState.items[i];
                    if (
                        this.x < item.x + item.width &&
                        this.x + this.width > item.x &&
                        this.y < item.y + item.height &&
                        this.y + this.height > item.y
                    ) {
                        this.pickupItem(item, i);
                    }
                }

                // Verifica colis√£o com √°cido
                for (let i = gameState.acidBullets.length - 1; i >= 0; i--) {
                    const acid = gameState.acidBullets[i];
                    if (
                        this.x < acid.x + acid.width &&
                        this.x + this.width > acid.x &&
                        this.y < acid.y + acid.height &&
                        this.y + this.height > acid.y
                    ) {
                        this.takeDamage(5);
                        gameState.acidBullets.splice(i, 1);
                    }
                }
                
                // Verifica colis√£o com proj√©teis do boss
                for (let i = gameState.bossProjectiles.length - 1; i >= 0; i--) {
                    const projectile = gameState.bossProjectiles[i];
                    if (
                        this.x < projectile.x + projectile.width &&
                        this.x + this.width > projectile.x &&
                        this.y < projectile.y + projectile.height &&
                        this.y + this.height > projectile.y
                    ) {
                        this.takeDamage(15);
                        gameState.bossProjectiles.splice(i, 1);
                    }
                }
            }

            pickupItem(item, index) {
                if (item.type === 'coin') {
                    gameState.coins += item.value;
                    gameState.items.splice(index, 1);
                    updateCoinUI();
                    return;
                }

                // Muni√ß√£o vai direto para a arma correspondente
                if (item.type === 'pistolAmmo') {
                    for (let i = 0; i < gameState.inventory.length; i++) {
                        if (gameState.inventory[i].type === 'pistol') {
                            gameState.inventory[i].ammo += 12;
                            gameState.items.splice(index, 1);
                            updateInventoryUI();
                            return;
                        }
                    }
                } else if (item.type === 'shotgunAmmo') {
                    for (let i = 0; i < gameState.inventory.length; i++) {
                        if (gameState.inventory[i].type === 'shotgun') {
                            gameState.inventory[i].ammo += 5;
                            gameState.items.splice(index, 1);
                            updateInventoryUI();
                            return;
                        }
                    }
                } else if (item.type === 'laserRifle') {
                    gameState.hasLaserRifle = true;
                    gameState.items.splice(index, 1);
                    // Adiciona ao invent√°rio com 10 balas
                    for (let i = 0; i < gameState.inventory.length; i++) {
                        if (gameState.inventory[i].type === 'empty') {
                            gameState.inventory[i] = { type: 'laserRifle', ammo: 10 };
                            updateInventoryUI();
                            return;
                        }
                    }
                }

                // Outros itens
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === item.type) {
                        if (gameState.inventory[i].ammo !== null) {
                            gameState.inventory[i].ammo += 1;
                            gameState.items.splice(index, 1);
                            updateInventoryUI();
                            return;
                        }
                    } else if (gameState.inventory[i].type === 'empty') {
                        gameState.inventory[i] = { type: item.type, ammo: 1 };
                        gameState.items.splice(index, 1);
                        updateInventoryUI();
                        return;
                    }
                }
            }

            draw() {
                // Desenha sombra
                ctx.fillStyle = 'rgba(0,0,0,0.5)';
                ctx.beginPath();
                ctx.ellipse(
                    this.x + this.width / 2,
                    this.y + this.height - 5,
                    this.width / 2,
                    this.width / 6,
                    0, 0, Math.PI * 2
                );
                ctx.fill();
                
                // Desenha jogador
                ctx.save();
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                ctx.rotate(this.angle);
                ctx.drawImage(
                    sprites.player,
                    -this.width / 2,
                    -this.height / 2,
                    this.width,
                    this.height
                );
                
                const weaponType = gameState.inventory[gameState.selectedSlot].type;
                const weaponAmmo = gameState.inventory[gameState.selectedSlot].ammo;
                
                if (weaponType === 'knife' && this.isAttacking) {
                    ctx.save();
                    ctx.rotate(this.knifeAngle - Math.PI / 4);
                    ctx.drawImage(
                        sprites.weapons.knife,
                        -sprites.weapons.knife.width / 2 + 20,
                        -sprites.weapons.knife.height / 2
                    );
                    ctx.restore();
                } else if (weaponType === 'pistol') {
                    ctx.drawImage(
                        sprites.weapons.pistol,
                        15,
                        -sprites.weapons.pistol.height / 2
                    );
                } else if (weaponType === 'shotgun') {
                    ctx.drawImage(
                        sprites.weapons.shotgun,
                        15,
                        -sprites.weapons.shotgun.height / 2
                    );
                } else if (weaponType === 'laserRifle') {
                    ctx.drawImage(
                        sprites.weapons.laserRifle,
                        15,
                        -sprites.weapons.laserRifle.height / 2
                    );
                } else if (weaponType === 'medkit' && weaponAmmo > 0) {
                    ctx.drawImage(
                        sprites.weapons.medkit,
                        15,
                        -sprites.weapons.medkit.height / 2
                    );
                } else if (weaponType === 'grenade' && weaponAmmo > 0) {
                    ctx.drawImage(
                        sprites.weapons.grenade,
                        15,
                        -sprites.weapons.grenade.height / 2
                    );
                }
                
                ctx.restore();
            }

            takeDamage(amount) {
                this.health -= amount;
                gameState.bloodEffect = 1;
                document.getElementById('bloodOverlay').style.opacity = '0.7';
                setTimeout(() => {
                    document.getElementById('bloodOverlay').style.opacity = '0';
                }, 300);
                
                if (this.health <= 0) {
                    this.health = 0;
                    gameState.gameOver = true;
                    document.getElementById('gameOverScreen').style.display = 'flex';
                    document.getElementById('survivedDays').textContent = gameState.day;
                }
            }

            meleeAttack() {
                if (gameState.attackCooldown > 0 || this.isAttacking) return;
                
                this.isAttacking = true;
                this.knifeAngle = 0;
                gameState.attackCooldown = 30;
                
                // Verifica acerto nos zumbis
                const attackRange = 70;
                const attackAngle = this.angle;
                const attackArc = Math.PI / 2;
                
                gameState.zombies.forEach(zombie => {
                    const dx = zombie.x + zombie.width / 2 - (this.x + this.width / 2);
                    const dy = zombie.y + zombie.height / 2 - (this.y + this.height / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < attackRange) {
                        const angleToZombie = Math.atan2(dy, dx);
                        const angleDiff = Math.abs(normalizeAngle(angleToZombie - attackAngle));
                        
                        if (angleDiff < attackArc / 2) {
                            zombie.takeDamage(25 * this.damageMultiplier);
                        }
                    }
                });
                
                this.stamina -= 10;
                if (this.stamina < 0) this.stamina = 0;
            }

            heal(amount) {
                this.health = Math.min(this.health + amount, this.maxHealth);
                // Efeito visual de cura
                document.getElementById('healEffect').style.opacity = '0.7';
                setTimeout(() => {
                    document.getElementById('healEffect').style.opacity = '0';
                }, 500);
            }

            increaseMaxHealth(amount) {
                this.maxHealth = Math.floor(this.maxHealth * 1.1);
                this.health = Math.floor(this.health * 1.1);
            }

            increaseMaxStamina(amount) {
                this.maxStamina = Math.floor(this.maxStamina * 1.1);
                this.stamina = Math.floor(this.stamina * 1.1);
            }

            increaseDamage(multiplier) {
                this.damageMultiplier *= 1.1;
            }

            increaseSpeed(amount) {
                this.speed *= 1.1;
            }

            useMedkit() {
                if (gameState.inventory[3].ammo > 0) {
                    this.heal(this.maxHealth * 0.15);
                    gameState.inventory[3].ammo--;
                    updateInventoryUI();
                    return true;
                }
                return false;
            }

            throwGrenade(targetX, targetY) {
                if (gameState.inventory[4].ammo > 0) {
                    const startX = this.x + this.width / 2;
                    const startY = this.y + this.height / 2;
                    
                    // Calcula o √¢ngulo
                    const angle = Math.atan2(
                        targetY - startY,
                        targetX - startX
                    );
                    
                    // Cria granada que vai em linha reta
                    gameState.grenades.push({
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * 8, // Velocidade fixa
                        vy: Math.sin(angle) * 8,
                        timer: 90, // 1.5 segundos
                        exploded: false,
                        distanceTraveled: 0,
                        maxDistance: 500, // Dist√¢ncia m√°xima
                        flashTimer: 0,
                        stuckZombie: null
                    });
                    
                    gameState.inventory[4].ammo--;
                    updateInventoryUI();
                    return true;
                }
                return false;
            }

            fireLaserRifle(targetX, targetY) {
                if (gameState.laserRifleCooldown > 0) return false;
                
                const startX = this.x + this.width / 2;
                const startY = this.y + this.height / 2;
                const angle = Math.atan2(targetY - startY, targetX - startX);
                
                // Cria o laser beam
                const laserLength = 1000;
                const endX = startX + Math.cos(angle) * laserLength;
                const endY = startY + Math.sin(angle) * laserLength;
                
                // Desenha o laser
                const laserBeam = document.createElement('div');
                laserBeam.className = 'laser-beam';
                laserBeam.style.left = `${startX}px`;
                laserBeam.style.top = `${startY}px`;
                laserBeam.style.width = `${laserLength}px`;
                laserBeam.style.height = '10px';
                laserBeam.style.transform = `rotate(${angle}rad)`;
                laserBeam.style.transformOrigin = '0 0';
                document.body.appendChild(laserBeam);
                
                // Remove ap√≥s um curto per√≠odo
                setTimeout(() => {
                    laserBeam.remove();
                }, 100);
                
                // Dano aos zumbis em linha reta
                gameState.zombies.forEach(zombie => {
                    const zombieCenterX = zombie.x + zombie.width / 2;
                    const zombieCenterY = zombie.y + zombie.height / 2;
                    
                    // Verifica colis√£o com linha
                    if (pointToLineDistance(zombieCenterX, zombieCenterY, startX, startY, endX, endY) < 30) {
                        zombie.takeDamage(200); // Dano massivo
                    }
                });
                
                // Configura cooldown
                gameState.laserRifleCooldown = 1200; // 20 segundos (60 fps * 20)
                
                return true;
            }
        }

        // Fun√ß√£o auxiliar para calcular dist√¢ncia de ponto para linha
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;

            const dot = A * C + B * D;
            const len_sq = C * C + D * D;
            let param = -1;
            if (len_sq !== 0) param = dot / len_sq;

            let xx, yy;

            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }

            const dx = px - xx;
            const dy = py - yy;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Classe de Proj√©til de √Åcido
        class AcidBullet {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.speed = 5;
                this.angle = angle;
                this.lifetime = 100;
            }

            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.lifetime--;
            }

            draw() {
                ctx.fillStyle = 'rgba(0, 255, 0, 0.7)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Classe de Proj√©til do Boss
        class BossProjectile {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.speed = 4;
                this.angle = angle;
                this.lifetime = 180;
            }

            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.lifetime--;
            }

            draw() {
                ctx.fillStyle = 'rgba(255, 0, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Tipos de zumbis
        class Zombie {
            constructor(x, y, type = 'normal') {
                this.x = x;
                this.y = y;
                this.width = type === 'boss' ? 80 : 40;
                this.height = type === 'boss' ? 80 : 40;
                this.type = type;
                this.health = this.getMaxHealth();
                this.speed = this.getSpeed();
                this.detectionRange = this.getDetectionRange();
                this.attackCooldown = 0;
                this.damage = this.getDamage();
                this.color = this.getColor();
                this.randomAngle = Math.random() * Math.PI * 2;
                this.lastSoundTime = 0;
                this.coinValue = this.getCoinValue();
                this.lastAcidShot = 0;
                this.specialAbilityCooldown = 0;
                this.lastBossAttack = 0;
            }
            
            getMaxHealth() {
                switch (this.type) {
                    case 'runner': return 80;
                    case 'brute': return 150;
                    case 'crawler': return 60;
                    case 'toxic': return 90;
                    case 'tank': return 250;
                    case 'fast': return 80;
                    case 'spitter': return 100;
                    case 'boss': return 500 + (gameState.day * 100);
                    default: return 100;
                }
            }
            
            getSpeed() {
                const nightBonus = gameState.isNight ? 1.2 : 1;
                switch (this.type) {
                    case 'runner': return 2.5 * nightBonus;
                    case 'brute': return 1.2 * nightBonus;
                    case 'crawler': return 1.5 * nightBonus;
                    case 'toxic': return 1.8 * nightBonus;
                    case 'tank': return 1.0 * nightBonus;
                    case 'fast': return 3.0 * nightBonus;
                    case 'spitter': return 1.8 * nightBonus;
                    case 'boss': return 1.5 * nightBonus;
                    default: return 1.8 * nightBonus;
                }
            }
            
            getDetectionRange() {
                switch (this.type) {
                    case 'runner': return 250;
                    case 'brute': return 350;
                    case 'crawler': return 200;
                    case 'toxic': return 300;
                    case 'tank': return 400;
                    case 'fast': return 300;
                    case 'spitter': return 350;
                    case 'boss': return 500;
                    default: return 300;
                }
            }
            
            getDamage() {
                switch (this.type) {
                    case 'runner': return 8;
                    case 'brute': return 15;
                    case 'crawler': return 5;
                    case 'toxic': return 12;
                    case 'tank': return 20;
                    case 'fast': return 6;
                    case 'spitter': return 5;
                    case 'boss': return 30;
                    default: return 10;
                }
            }
            
            getColor() {
                switch (this.type) {
                    case 'runner': return '#c78f6b';
                    case 'brute': return '#6b8fbb';
                    case 'crawler': return '#6b8f6b';
                    case 'toxic': return '#8fbb8f';
                    case 'tank': return '#ff8800';
                    case 'fast': return '#aa55ff';
                    case 'spitter': return '#55aaff';
                    case 'boss': return '#ff0000';
                    default: return '#8fbb6b';
                }
            }

            getCoinValue() {
                switch (this.type) {
                    case 'runner': return 3;
                    case 'brute': return 5;
                    case 'crawler': return 2;
                    case 'toxic': return 4;
                    case 'tank': return 15;
                    case 'fast': return 10;
                    case 'spitter': return 13;
                    case 'boss': return 100;
                    default: return 2;
                }
            }

            update() {
                const player = gameState.player;
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // IA: Persegui√ß√£o ou movimento aleat√≥rio
                if (distance < this.detectionRange) {
                    // Persegue o jogador
                    const angle = Math.atan2(dy, dx);
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;
                    
                    // Ataque se estiver perto
                    if (distance < (this.type === 'boss' ? 60 : 40) && this.attackCooldown <= 0) {
                        player.takeDamage(this.damage);
                        this.attackCooldown = this.type === 'boss' ? 30 : 60;
                    }
                    
                    // Zumbis cuspidores atiram √°cido
                    if (this.type === 'spitter' && Date.now() - this.lastAcidShot > 4000 && distance < 300) {
                        this.lastAcidShot = Date.now();
                        gameState.acidBullets.push(new AcidBullet(
                            this.x + this.width / 2,
                            this.y + this.height / 2,
                            angle
                        ));
                    }
                    
                    // Habilidade especial do boss
                    if (this.type === 'boss') {
                        // Ataque de proj√©teis
                        if (Date.now() - this.lastBossAttack > 3000 && distance < 500) {
                            this.lastBossAttack = Date.now();
                            
                            // Dispara 3 proj√©teis em dire√ß√µes diferentes
                            for (let i = 0; i < 3; i++) {
                                const spread = (i - 1) * Math.PI / 8;
                                gameState.bossProjectiles.push(new BossProjectile(
                                    this.x + this.width/2,
                                    this.y + this.height/2,
                                    angle + spread
                                ));
                            }
                        }
                    }
                } else {
                    // Movimento aleat√≥rio
                    if (Math.random() < 0.02) {
                        this.randomAngle = Math.random() * Math.PI * 2;
                    }
                    this.x += Math.cos(this.randomAngle) * this.speed * 0.5;
                    this.y += Math.sin(this.randomAngle) * this.speed * 0.5;
                }

                // Cooldown do ataque
                if (this.attackCooldown > 0) this.attackCooldown--;
                if (this.specialAbilityCooldown > 0) this.specialAbilityCooldown--;

                // Limites do mapa
                this.x = Math.max(0, Math.min(config.width - this.width, this.x));
                this.y = Math.max(0, Math.min(config.height - this.height, this.y));
            }

            draw() {
                // Desenha sombra
                ctx.fillStyle = 'rgba(0,0,0,0.5)';
                ctx.beginPath();
                ctx.ellipse(
                    this.x + this.width / 2,
                    this.y + this.height - 5,
                    this.width / 2,
                    this.width / 6,
                    0, 0, Math.PI * 2
                );
                ctx.fill();
                
                // Desenha zumbi
                let sprite;
                switch (this.type) {
                    case 'runner': sprite = sprites.zombies.runner; break;
                    case 'brute': sprite = sprites.zombies.brute; break;
                    case 'crawler': sprite = sprites.zombies.crawler; break;
                    case 'toxic': sprite = sprites.zombies.toxic; break;
                    case 'tank': sprite = sprites.zombies.tank; break;
                    case 'fast': sprite = sprites.zombies.fast; break;
                    case 'spitter': sprite = sprites.zombies.spitter; break;
                    case 'boss': sprite = sprites.zombies.boss; break;
                    default: sprite = sprites.zombies.normal;
                }
                
                ctx.drawImage(sprite, this.x, this.y, this.width, this.height);
                
                // Barra de vida
                if (this.health < this.getMaxHealth()) {
                    ctx.fillStyle = '#300';
                    ctx.fillRect(this.x, this.y - 12, this.width, 5);
                    ctx.fillStyle = this.type === 'boss' ? '#f0f' : '#f00';
                    ctx.fillRect(this.x, this.y - 12, this.width * (this.health / this.getMaxHealth()), 5);
                }
            }

            takeDamage(amount) {
                // Boss tem 50% de resist√™ncia a proj√©teis
                if (this.type === 'boss') {
                    // Verifica se o dano vem de proj√©teis (pistola, shotgun ou granada)
                    const isProjectileDamage = gameState.bullets.length > 0 || 
                                             (gameState.grenades.length > 0 && gameState.grenades.some(g => !g.exploded));
                    
                    if (isProjectileDamage) {
                        amount *= 0.5; // Reduz o dano pela metade
                    }
                }
                
                this.health -= amount;
                if (this.health <= 0) {
                    // Drop de moedas
                    gameState.items.push({
                        type: 'coin',
                        x: this.x,
                        y: this.y,
                        width: 20,
                        height: 20,
                        value: this.coinValue
                    });
                    
                    // Chance de dropar item
                    if (Math.random() < this.getDropChance()) {
                        this.dropItem();
                    }
                    
                    // Chance especial do boss dropar a arma laser
                    if (this.type === 'boss' && Math.random() < 0.05) {
                        gameState.items.push({
                            type: 'laserRifle',
                            x: this.x,
                            y: this.y,
                            width: 30,
                            height: 30
                        });
                    }
                    
                    gameState.coins += this.coinValue;
                    updateCoinUI();
                    
                    if (this.type === 'boss') {
                        gameState.bossSpawned = false;
                        gameState.bossAlive = false;
                        // Quando o boss morre, termina a noite imediatamente
                        endNight();
                    }
                    
                    const index = gameState.zombies.indexOf(this);
                    if (index !== -1) gameState.zombies.splice(index, 1);
                    gameState.zombiesSpawned--;
                }
            }
            
            getDropChance() {
                switch (this.type) {
                    case 'runner': return 0.1;
                    case 'brute': return 0.2;
                    case 'crawler': return 0.05;
                    case 'toxic': return 0.15;
                    case 'tank': return 0.3;
                    case 'fast': return 0.25;
                    case 'spitter': return 0.25;
                    case 'boss': return 0.8;
                    default: return 0.1;
                }
            }
            
            dropItem() {
                const items = [
                    { type: 'pistolAmmo', chance: this.getCommonItemChance() },
                    { type: 'shotgunAmmo', chance: this.getUncommonItemChance() },
                    { type: 'medkit', chance: this.getRareItemChance() },
                    { type: 'grenade', chance: this.getLegendaryItemChance() }
                ];
                
                let selectedItem = null;
                let roll = Math.random();
                
                for (const item of items) {
                    if (roll < item.chance) {
                        selectedItem = item.type;
                        break;
                    }
                    roll -= item.chance;
                }
                
                if (selectedItem) {
                    gameState.items.push({
                        type: selectedItem,
                        x: this.x,
                        y: this.y,
                        width: 20,
                        height: 20
                    });
                }
            }
            
            getCommonItemChance() {
                switch (this.type) {
                    case 'runner': return 0.7;
                    case 'brute': return 0.5;
                    case 'crawler': return 0.8;
                    case 'toxic': return 0.6;
                    case 'tank': return 0.3;
                    case 'fast': return 0.4;
                    case 'spitter': return 0.4;
                    case 'boss': return 0.1;
                    default: return 0.7;
                }
            }
            
            getUncommonItemChance() {
                switch (this.type) {
                    case 'runner': return 0.2;
                    case 'brute': return 0.3;
                    case 'crawler': return 0.1;
                    case 'toxic': return 0.2;
                    case 'tank': return 0.3;
                    case 'fast': return 0.3;
                    case 'spitter': return 0.3;
                    case 'boss': return 0.2;
                    default: return 0.2;
                }
            }
            
            getRareItemChance() {
                switch (this.type) {
                    case 'runner': return 0.1;
                    case 'brute': return 0.15;
                    case 'crawler': return 0.05;
                    case 'toxic': return 0.15;
                    case 'tank': return 0.25;
                    case 'fast': return 0.2;
                    case 'spitter': return 0.2;
                    case 'boss': return 0.3;
                    default: return 0.1;
                }
            }
            
            getLegendaryItemChance() {
                switch (this.type) {
                    case 'runner': return 0.0;
                    case 'brute': return 0.05;
                    case 'crawler': return 0.0;
                    case 'toxic': return 0.05;
                    case 'tank': return 0.15;
                    case 'fast': return 0.1;
                    case 'spitter': return 0.1;
                    case 'boss': return 0.4;
                    default: return 0.0;
                }
            }
        }

        // Classe de Proj√©til
        class Bullet {
            constructor(x, y, angle, type = 'pistol') {
                this.x = x;
                this.y = y;
                this.speed = type === 'pistol' ? 15 : 12;
                this.angle = angle;
                this.damage = type === 'pistol' ? 35 * gameState.player.damageMultiplier : 28 * gameState.player.damageMultiplier; // Shotgun faz 20% menos dano por proj√©til
                this.lifetime = type === 'pistol' ? 70 : 50;
                this.type = type;
                this.spread = type === 'pistol' ? 0 : Math.PI / 16;
            }

            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.lifetime--;

                // Verifica colis√£o com zumbis
                gameState.zombies.forEach(zombie => {
                    if (
                        this.x > zombie.x && this.x < zombie.x + zombie.width &&
                        this.y > zombie.y && this.y < zombie.y + zombie.height
                    ) {
                        zombie.takeDamage(this.damage);
                        this.lifetime = 0;
                    }
                });

                // Verifica colis√£o com obst√°culos
                for (const obstacle of gameState.obstacles) {
                    if (
                        this.x > obstacle.x && this.x < obstacle.x + obstacle.width &&
                        this.y > obstacle.y && this.y < obstacle.y + obstacle.height
                    ) {
                        this.lifetime = 0;
                        break;
                    }
                }
            }

            draw() {
                ctx.fillStyle = this.type === 'pistol' ? '#ffcc55' : '#ffaa00';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.type === 'pistol' ? 3 : 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Rastro
                ctx.strokeStyle = this.type === 'pistol' ? 'rgba(255, 200, 0, 0.5)' : 'rgba(255, 170, 0, 0.5)';
                ctx.lineWidth = this.type === 'pistol' ? 1 : 2;
                ctx.beginPath();
                ctx.moveTo(
                    this.x - Math.cos(this.angle) * 10,
                    this.y - Math.sin(this.angle) * 10
                );
                ctx.lineTo(this.x, this.y);
                ctx.stroke();
            }
        }

        // Sistema de part√≠culas
        const particles = [];
        
        function createParticle(x, y, vx, vy, color, lifetime) {
            particles.push({
                x, y, vx, vy, color, lifetime, maxLifetime: lifetime
            });
        }
        
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.lifetime--;
                
                if (p.lifetime <= 0) {
                    particles.splice(i, 1);
                }
            }
        }
        
        function drawParticles() {
            particles.forEach(p => {
                const alpha = p.lifetime / p.maxLifetime;
                ctx.fillStyle = `${p.color}${Math.floor(alpha * 255).toString(16).padStart(2, '0')}`;
                ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
            });
        }

        // Gera√ß√£o procedural de mapa
        function generateMap() {
            const tileSize = Math.max(config.width, config.height) / config.mapTiles;
            const map = [];
            
            // Gera um mapa baseado em ru√≠do
            for (let y = 0; y < config.mapTiles; y++) {
                map[y] = [];
                for (let x = 0; x < config.mapTiles; x++) {
                    // Usa um ru√≠do simples para determinar o tipo de terreno
                    const noise = Math.random();
                    
                    if (noise < 0.1) {
                        map[y][x] = 'water';
                    } else if (noise < 0.3) {
                        map[y][x] = 'road';
                    } else if (noise < 0.35) {
                        map[y][x] = 'building';
                    } else {
                        map[y][x] = 'grass';
                    }
                }
            }
            
            return map;
        }
        
        function drawMap() {
            const tileSize = Math.max(config.width, config.height) / config.mapTiles;
            
            for (let y = 0; y < gameState.map.length; y++) {
                for (let x = 0; x < gameState.map[y].length; x++) {
                    const tileType = gameState.map[y][x];
                    let sprite;
                    
                    switch (tileType) {
                        case 'water': sprite = sprites.terrain.water; break;
                        case 'road': sprite = sprites.terrain.road; break;
                        case 'building': sprite = sprites.terrain.building; break;
                        default: sprite = sprites.terrain.grass;
                    }
                    
                    ctx.drawImage(
                        sprite,
                        x * tileSize,
                        y * tileSize,
                        tileSize,
                        tileSize
                    );
                }
            }
        }

        // Inicializa√ß√£o do jogo
        function initGame() {
            gameState.player = new Player(config.width / 2, config.height / 2);
            gameState.zombies = [];
            gameState.bullets = [];
            gameState.acidBullets = [];
            gameState.bossProjectiles = [];
            gameState.grenades = [];
            gameState.explosions = [];
            gameState.items = [];
            gameState.day = 1;
            gameState.gameTime = 0;
            gameState.gameOver = false;
            gameState.attackCooldown = 0;
            gameState.map = generateMap();
            gameState.coins = 0;
            gameState.playerDamageMultiplier = 1;
            gameState.zombiesToSpawn = config.baseZombiesPerNight;
            gameState.zombiesSpawned = 0;
            gameState.shopOpen = false;
            gameState.itemSpawnTimer = 0;
            gameState.bossSpawned = false;
            gameState.bossAlive = false;
            gameState.pistolCooldown = 0;
            gameState.shotgunCooldown = 0;
            gameState.laserRifleCooldown = 0;
            gameState.hasLaserRifle = false;
            
            // Reset shop prices
            gameState.shopPrices = {
                ammo: 12,
                shotgunAmmo: 25,
                medkit: 8,
                grenades: 40,
                health: 20,
                damage: 15,
                speed: 18
            };
            
            // Inicia com faca e sem outras armas
            gameState.inventory = [
                { type: 'knife', ammo: null },
                { type: 'pistol', ammo: 0 },
                { type: 'shotgun', ammo: 0 },
                { type: 'medkit', ammo: 0 },
                { type: 'grenade', ammo: 0 }
            ];
            gameState.selectedSlot = 0;
            updateInventoryUI();
            updateCoinUI();
            updateShopPricesUI();
            
            // Gera√ß√£o de obst√°culos
            gameState.obstacles = [];
            for (let i = 0; i < 20; i++) {
                gameState.obstacles.push({
                    x: Math.random() * (config.width - 100),
                    y: Math.random() * (config.height - 100),
                    width: 60 + Math.random() * 80,
                    height: 60 + Math.random() * 80,
                    type: ['building', 'car', 'tree'][Math.floor(Math.random() * 3)]
                });
            }
            
            // Inicia o loop do jogo
            gameLoop();
            dayNightCycle();
            itemSpawnLoop();
        }

        // Loop principal do jogo
        function gameLoop() {
            if (gameState.gameOver) return;
            
            ctx.clearRect(0, 0, config.width, config.height);
            
            // Desenha mapa
            drawMap();
            
            // Desenha obst√°culos
            ctx.fillStyle = 'rgba(50, 50, 50, 1)';
            gameState.obstacles.forEach(obstacle => {
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                // Detalhes dos obst√°culos
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
            
            // Desenha itens no ch√£o
            gameState.items.forEach(item => {
                let sprite;
                switch (item.type) {
                    case 'pistol': sprite = sprites.items.pistol; break;
                    case 'shotgun': sprite = sprites.items.shotgun; break;
                    case 'pistolAmmo': sprite = sprites.items.pistolAmmo; break;
                    case 'shotgunAmmo': sprite = sprites.items.shotgunAmmo; break;
                    case 'medkit': sprite = sprites.items.medkit; break;
                    case 'grenade': sprite = sprites.items.grenade; break;
                    case 'coin': sprite = sprites.items.coin; break;
                    case 'laserRifle': sprite = sprites.items.laserRifle; break;
                }
                
                // Efeito de flutua√ß√£o
                const floatY = Math.sin(Date.now() / 500) * 3;
                
                ctx.drawImage(
                    sprite,
                    item.x,
                    item.y + floatY,
                    item.width,
                    item.height
                );
            });
            
            // Atualiza e desenha part√≠culas
            updateParticles();
            drawParticles();
            
            // Atualiza e desenha proj√©teis do boss
            for (let i = gameState.bossProjectiles.length - 1; i >= 0; i--) {
                const projectile = gameState.bossProjectiles[i];
                projectile.update();
                
                // Desenha proj√©til
                ctx.fillStyle = 'rgba(255, 0, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(projectile.x, projectile.y, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Remove proj√©teis fora do mapa ou sem vida √∫til
                if (projectile.lifetime <= 0 ||
                    projectile.x < 0 || projectile.x > config.width ||
                    projectile.y < 0 || projectile.y > config.height) {
                    gameState.bossProjectiles.splice(i, 1);
                }
            }
            
            // Atualiza e desenha granadas
            for (let i = gameState.grenades.length - 1; i >= 0; i--) {
                const grenade = gameState.grenades[i];
                
                // Desenha granada
                const flashIntensity = grenade.flashTimer > 0 ? 
                    (grenade.flashTimer % 10 < 5 ? 1 : 0.5) : 1;
                
                ctx.fillStyle = `rgba(255, 0, 0, ${flashIntensity})`;
                ctx.beginPath();
                ctx.arc(grenade.x, grenade.y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = `rgba(255, 165, 0, ${flashIntensity})`;
                ctx.beginPath();
                ctx.arc(grenade.x, grenade.y, 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Verifica colis√£o com zumbis
                if (!grenade.exploded && !grenade.stuckZombie) {
                    for (const zombie of gameState.zombies) {
                        if (
                            grenade.x > zombie.x && grenade.x < zombie.x + zombie.width &&
                            grenade.y > zombie.y && grenade.y < zombie.y + zombie.height
                        ) {
                            grenade.stuckZombie = zombie;
                            grenade.exploded = true;
                            grenade.flashTimer = 0; // Explode imediatamente
                            break;
                        }
                    }
                }
                
                // Se grudou em um zumbi, segue ele
                if (grenade.stuckZombie) {
                    grenade.x = grenade.stuckZombie.x + grenade.stuckZombie.width / 2;
                    grenade.y = grenade.stuckZombie.y + grenade.stuckZombie.height / 2;
                }
                
                // Atualiza posi√ß√£o
                if (!grenade.exploded && !grenade.stuckZombie) {
                    grenade.x += grenade.vx;
                    grenade.y += grenade.vy;
                    grenade.distanceTraveled += Math.sqrt(grenade.vx * grenade.vx + grenade.vy * grenade.vy);
                    
                    // Verifica se chegou no limite de dist√¢ncia
                    if (grenade.distanceTraveled >= grenade.maxDistance) {
                        grenade.exploded = true;
                        grenade.flashTimer = 90; // 1.5 segundos de piscar
                    }
                } else if (grenade.exploded) {
                    // Contagem regressiva para explos√£o
                    grenade.flashTimer--;
                    
                    if (grenade.flashTimer <= 0) {
                        // Cria explos√£o
                        gameState.explosions.push({
                            x: grenade.x,
                            y: grenade.y,
                            radius: 0,
                            maxRadius: 70, // Raio maior da explos√£o visual
                            timer: 30
                        });
                        
                        // Dano aos zumbis - raio maior de dano
                        gameState.zombies.forEach(zombie => {
                            const dx = zombie.x + zombie.width/2 - grenade.x;
                            const dy = zombie.y + zombie.height/2 - grenade.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 500) { // √Årea de dano maior
                                // Dano diminui com a dist√¢ncia
                                const damage = 300 * (1 - distance/250); // Dano aumentado
                                zombie.takeDamage(damage);
                            }
                        });
                        
                        gameState.grenades.splice(i, 1);
                    }
                }
            }
            
            // Atualiza e desenha explos√µes
            for (let i = gameState.explosions.length - 1; i >= 0; i--) {
                const explosion = gameState.explosions[i];
                
                // Desenha explos√£o
                const gradient = ctx.createRadialGradient(
                    explosion.x, explosion.y, 0,
                    explosion.x, explosion.y, explosion.radius
                );
                gradient.addColorStop(0, 'rgba(255, 100, 0, 0.8)');
                gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, explosion.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Expande a explos√£o
                explosion.radius += explosion.maxRadius / 6; // Mais r√°pido
                explosion.timer--;
                
                // Remove explos√£o acabada
                if (explosion.timer <= 0) {
                    gameState.explosions.splice(i, 1);
                }
            }
            
            // Atualiza e desenha proj√©teis de √°cido
            gameState.acidBullets.forEach((acid, index) => {
                acid.update();
                acid.draw();
                
                if (acid.lifetime <= 0) {
                    gameState.acidBullets.splice(index, 1);
                }
            });
            
            // Atualiza e desenha jogador
            gameState.player.update();
            gameState.player.draw();
            
            // Atualiza e desenha zumbis
            gameState.zombies.forEach(zombie => {
                zombie.update();
                zombie.draw();
            });
            
            // Spawn de zumbis durante a noite
            if (gameState.isNight && gameState.zombiesSpawned < gameState.zombiesToSpawn && !gameState.bossAlive) {
                spawnZombie();
            }
            
            // Spawn do boss a cada 5 dias
            if (gameState.isNight && gameState.day % 5 === 0 && !gameState.bossSpawned && gameState.zombiesSpawned >= Math.floor(gameState.zombiesToSpawn * 0.7)) {
                spawnBoss();
                gameState.bossSpawned = true;
                gameState.bossAlive = true;
            }
            
            // Remove todos os zumbis quando o dia come√ßa
            if (!gameState.isNight && gameState.zombies.length > 0) {
                gameState.zombies = [];
                gameState.zombiesSpawned = 0;
                gameState.bossSpawned = false;
                gameState.bossAlive = false;
            }
            
            // Atualiza e desenha proj√©teis
            gameState.bullets.forEach((bullet, index) => {
                bullet.update();
                bullet.draw();
                
                // Remove proj√©teis fora do mapa ou sem vida √∫til
                if (
                    bullet.lifetime <= 0 ||
                    bullet.x < 0 || bullet.x > config.width ||
                    bullet.y < 0 || bullet.y > config.height
                ) {
                    gameState.bullets.splice(index, 1);
                }
            });
            
            // Atualiza cooldowns
            if (gameState.pistolCooldown > 0) {
                gameState.pistolCooldown--;
            }
            if (gameState.shotgunCooldown > 0) {
                gameState.shotgunCooldown--;
            }
            if (gameState.attackCooldown > 0) {
                gameState.attackCooldown--;
            }
            if (gameState.laserRifleCooldown > 0) {
                gameState.laserRifleCooldown--;
            }
            
            // Atualiza UI
            document.getElementById('zombieCount').textContent = gameState.zombies.length;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('dayTime').textContent = gameState.isNight ? 'üåô NOITE' : '‚òÄÔ∏è DIA';
            document.getElementById('dayTime').style.color = gameState.isNight ? '#ff5555' : '#ffcc55';
            
            // Atualiza contador de tempo ou mensagem do boss
            if (gameState.bossAlive) {
                document.getElementById('timeLeft').style.display = 'none';
                document.getElementById('bossMessage').style.display = 'block';
            } else {
                document.getElementById('timeLeft').style.display = 'block';
                document.getElementById('bossMessage').style.display = 'none';
                const timeLeft = gameState.isNight 
                    ? Math.ceil((config.nightDuration - gameState.gameTime) / 1000)
                    : Math.ceil((config.dayDuration - gameState.gameTime) / 1000);
                document.getElementById('timeLeft').textContent = `TEMPO: ${timeLeft}s`;
            }
            
            // Atualiza indicadores de cooldown
            updateCooldownIndicators();
            
            requestAnimationFrame(gameLoop);
        }

        function updateCooldownIndicators() {
            // Remove todos os indicadores existentes
            document.querySelectorAll('.cooldown-indicator').forEach(el => el.remove());
            
            // Pistola
            if (gameState.pistolCooldown > 0) {
                const slot = document.querySelectorAll('.inventory-slot')[1];
                const indicator = document.createElement('div');
                indicator.className = 'cooldown-indicator';
                indicator.textContent = Math.ceil(gameState.pistolCooldown / 60);
                slot.appendChild(indicator);
            }
            
            // Shotgun
            if (gameState.shotgunCooldown > 0) {
                const slot = document.querySelectorAll('.inventory-slot')[2];
                const indicator = document.createElement('div');
                indicator.className = 'cooldown-indicator';
                indicator.textContent = Math.ceil(gameState.shotgunCooldown / 60);
                slot.appendChild(indicator);
            }
            
            // Laser Rifle (se tiver)
            if (gameState.hasLaserRifle && gameState.laserRifleCooldown > 0) {
                // Encontra o slot do laser rifle
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'laserRifle') {
                        const slot = document.querySelectorAll('.inventory-slot')[i];
                        const indicator = document.createElement('div');
                        indicator.className = 'cooldown-indicator';
                        indicator.textContent = Math.ceil(gameState.laserRifleCooldown / 60);
                        slot.appendChild(indicator);
                        break;
                    }
                }
            }
        }

        // Spawn de zumbis
        function spawnZombie() {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            
            switch (side) {
                case 0: x = -50; y = Math.random() * config.height; break; // Esquerda
                case 1: x = config.width + 50; y = Math.random() * config.height; break; // Direita
                case 2: x = Math.random() * config.width; y = -50; break; // Topo
                case 3: x = Math.random() * config.width; y = config.height + 50; break; // Base
            }
            
            // Escolhe tipo de zumbi baseado no dia
            let zombieTypes = ['normal', 'normal', 'normal', 'runner', 'brute', 'crawler', 'toxic'];
            let weights = [0.5, 0.5, 0.5, 0.3, 0.2, 0.3, 0.2];
            
            // Adiciona tipos especiais conforme os dias avan√ßam
            if (gameState.day >= 3) {
                zombieTypes.push('tank');
                weights.push(0.1);
            }
            if (gameState.day >= 5) {
                zombieTypes.push('fast');
                weights.push(0.15);
            }
            if (gameState.day >= 7) {
                zombieTypes.push('spitter');
                weights.push(0.15);
            }
            
            // Normaliza os pesos
            const sum = weights.reduce((a, b) => a + b, 0);
            weights = weights.map(w => w / sum);
            
            let selectedType = 'normal';
            let roll = Math.random();
            
            for (let i = 0; i < zombieTypes.length; i++) {
                if (roll < weights[i]) {
                    selectedType = zombieTypes[i];
                    break;
                }
                roll -= weights[i];
            }
            
            gameState.zombies.push(new Zombie(x, y, selectedType));
            gameState.zombiesSpawned++;
        }

        // Spawn do boss
        function spawnBoss() {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            
            switch (side) {
                case 0: x = -80; y = Math.random() * config.height; break; // Esquerda
                case 1: x = config.width + 80; y = Math.random() * config.height; break; // Direita
                case 2: x = Math.random() * config.width; y = -80; break; // Topo
                case 3: x = Math.random() * config.width; y = config.height + 80; break; // Base
            }
            
            gameState.zombies.push(new Zombie(x, y, 'boss'));
            gameState.zombiesSpawned++;
        }

        // Termina a noite imediatamente
        function endNight() {
            gameState.isNight = false;
            gameState.gameTime = 0;
            gameState.day++;
            gameState.zombiesToSpawn = config.baseZombiesPerNight + (gameState.day - 1) * config.zombieIncreasePerDay;
            gameState.zombiesSpawned = 0;
            document.getElementById('nightOverlay').style.display = 'none';
            
            // Abre a loja automaticamente
            openShop();
        }

        // Ciclo dia/noite
        function dayNightCycle() {
            if (gameState.gameOver) return;
            
            // Se for noite e tiver boss vivo, n√£o conta o tempo
            if (!(gameState.isNight && gameState.bossAlive)) {
                gameState.gameTime += 100;
            }
            
            if (gameState.isNight) {
                if (gameState.gameTime >= config.nightDuration && !gameState.bossAlive) {
                    // Fim da noite (s√≥ se n√£o tiver boss vivo)
                    gameState.isNight = false;
                    gameState.gameTime = 0;
                    gameState.day++;
                    gameState.zombiesToSpawn = config.baseZombiesPerNight + (gameState.day - 1) * config.zombieIncreasePerDay;
                    gameState.zombiesSpawned = 0;
                    document.getElementById('nightOverlay').style.display = 'none';
                    
                    // Abre a loja automaticamente
                    openShop();
                }
            } else {
                if (gameState.gameTime >= config.dayDuration) {
                    // Fim do dia
                    gameState.isNight = true;
                    gameState.gameTime = 0;
                    document.getElementById('nightOverlay').style.display = 'block';
                    
                    // Fecha a loja se estiver aberta
                    if (gameState.shopOpen) {
                        closeShop();
                    }
                }
            }
            
            setTimeout(dayNightCycle, 100);
        }

        // Spawn de itens
        function itemSpawnLoop() {
            if (gameState.gameOver) return;
            
            gameState.itemSpawnTimer += 100;
            
            if (gameState.itemSpawnTimer >= config.itemSpawnInterval) {
                gameState.itemSpawnTimer = 0;
                
                if (Math.random() < config.itemSpawnChance) {
                    const items = ['pistolAmmo', 'medkit'];
                    const selectedItem = items[Math.floor(Math.random() * items.length)];
                    
                    gameState.items.push({
                        type: selectedItem,
                        x: Math.random() * (config.width - 50),
                        y: Math.random() * (config.height - 50),
                        width: 20,
                        height: 20
                    });
                }
            }
            
            setTimeout(itemSpawnLoop, 100);
        }

        // Loja de melhorias
        function openShop() {
            if (gameState.isNight) return;
            gameState.shopOpen = true;
            document.getElementById('shop').style.display = 'block';
        }
        
        function closeShop() {
            gameState.shopOpen = false;
            document.getElementById('shop').style.display = 'none';
        }
        
        function updateShopPricesUI() {
            document.getElementById('ammoPrice').textContent = Math.floor(gameState.shopPrices.ammo);
            document.getElementById('shotgunAmmoPrice').textContent = Math.floor(gameState.shopPrices.shotgunAmmo);
            document.getElementById('medkitPrice').textContent = Math.floor(gameState.shopPrices.medkit);
            document.getElementById('grenadesPrice').textContent = Math.floor(gameState.shopPrices.grenades);
            document.getElementById('healthPrice').textContent = Math.floor(gameState.shopPrices.health);
            document.getElementById('damagePrice').textContent = Math.floor(gameState.shopPrices.damage);
            document.getElementById('speedPrice').textContent = Math.floor(gameState.shopPrices.speed);
        }
        
        function buyAmmo() {
            if (gameState.coins >= gameState.shopPrices.ammo) {
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'pistol') {
                        gameState.inventory[i].ammo += 12;
                        gameState.coins -= gameState.shopPrices.ammo;
                        // N√£o aumenta o pre√ßo para itens do arsenal
                        updateInventoryUI();
                        updateCoinUI();
                        updateShopPricesUI();
                        break;
                    }
                }
            }
        }
        
        function buyShotgunAmmo() {
            if (gameState.coins >= gameState.shopPrices.shotgunAmmo) {
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'shotgun') {
                        gameState.inventory[i].ammo += 5;
                        gameState.coins -= gameState.shopPrices.shotgunAmmo;
                        // N√£o aumenta o pre√ßo para itens do arsenal
                        updateInventoryUI();
                        updateCoinUI();
                        updateShopPricesUI();
                        break;
                    }
                }
            }
        }
        
        function buyHealth() {
            if (gameState.coins >= gameState.shopPrices.health) {
                gameState.player.increaseMaxHealth(10); // Reduzido para 10%
                gameState.coins -= gameState.shopPrices.health;
                gameState.shopPrices.health = Math.floor(gameState.shopPrices.health * 1.2); // Aumenta o pre√ßo apenas para status
                updateCoinUI();
                updateShopPricesUI();
            }
        }
        
        function buyDamage() {
            if (gameState.coins >= gameState.shopPrices.damage) {
                gameState.player.increaseDamage(0.1);
                gameState.coins -= gameState.shopPrices.damage;
                gameState.shopPrices.damage = Math.floor(gameState.shopPrices.damage * 1.2); // Aumenta o pre√ßo apenas para status
                updateCoinUI();
                updateShopPricesUI();
            }
        }
        
        function buySpeed() {
            if (gameState.coins >= gameState.shopPrices.speed) {
                gameState.player.increaseMaxStamina(10); // Agora aumenta stamina em 10%
                gameState.coins -= gameState.shopPrices.speed;
                gameState.shopPrices.speed = Math.floor(gameState.shopPrices.speed * 1.2); // Aumenta o pre√ßo apenas para status
                updateCoinUI();
                updateShopPricesUI();
            }
        }
        
        function buyMedkit() {
            if (gameState.coins >= gameState.shopPrices.medkit) {
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'medkit') {
                        gameState.inventory[i].ammo += 1;
                        gameState.coins -= gameState.shopPrices.medkit;
                        // N√£o aumenta o pre√ßo para itens do arsenal
                        updateInventoryUI();
                        updateCoinUI();
                        updateShopPricesUI();
                        break;
                    }
                }
            }
        }
        
        function buyGrenades() {
            if (gameState.coins >= gameState.shopPrices.grenades) {
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'grenade') {
                        gameState.inventory[i].ammo += 2;
                        gameState.coins -= gameState.shopPrices.grenades;
                        // N√£o aumenta o pre√ßo para itens do arsenal
                        updateInventoryUI();
                        updateCoinUI();
                        updateShopPricesUI();
                        break;
                    }
                }
            }
        }

        // Atualiza UI do invent√°rio
        function updateInventoryUI() {
            document.querySelectorAll('.inventory-slot').forEach((slot, index) => {
                // Verifica se √© o laser rifle (n√£o mostra na UI at√© ser desbloqueado)
                if (gameState.inventory[index].type === 'laserRifle' && !gameState.hasLaserRifle) {
                    slot.innerHTML = '‚ùì<div class="slot-ammo">?</div>';
                    return;
                }
                
                slot.innerHTML = getWeaponIcon(gameState.inventory[index].type);
                
                if (gameState.inventory[index].ammo !== null) {
                    slot.innerHTML += `<div class="slot-ammo">${gameState.inventory[index].ammo}</div>`;
                } else {
                    slot.innerHTML += '<div class="slot-ammo">-</div>';
                }
                
                if (index === gameState.selectedSlot) {
                    slot.classList.add('active');
                } else {
                    slot.classList.remove('active');
                }
            });
        }
        
        function updateCoinUI() {
            document.getElementById('coinCount').textContent = gameState.coins;
        }
        
        function getWeaponIcon(type) {
            switch (type) {
                case 'knife': return 'üî™';
                case 'pistol': return 'üî´';
                case 'shotgun': return 'üí•';
                case 'medkit': return 'ü©π';
                case 'grenade': return 'üß®';
                case 'pistolAmmo': return 'üîπ';
                case 'shotgunAmmo': return 'üî∏';
                case 'laserRifle': return 'üîã';
                default: return '‚ùì';
            }
        }

        // Controles
        window.addEventListener('keydown', (e) => {
            const player = gameState.player;
            
            switch (e.key) {
                case 'w': player.direction.y = -1; break;
                case 's': player.direction.y = 1; break;
                case 'a': player.direction.x = -1; break;
                case 'd': player.direction.x = 1; break;
                case 'Shift': player.isRunning = true; break;
                case '1': gameState.selectedSlot = 0; updateInventoryUI(); break;
                case '2': gameState.selectedSlot = 1; updateInventoryUI(); break;
                case '3': gameState.selectedSlot = 2; updateInventoryUI(); break;
                case '4': gameState.selectedSlot = 3; updateInventoryUI(); break;
                case '5': gameState.selectedSlot = 4; updateInventoryUI(); break;
                case 'r': reloadWeapon(); break;
                case 'e': 
                    if (!gameState.isNight && !gameState.shopOpen) {
                        openShop();
                    } else if (gameState.shopOpen) {
                        closeShop();
                    }
                    break;
            }
        });

        window.addEventListener('keyup', (e) => {
            const player = gameState.player;
            
            switch (e.key) {
                case 'w': if (player.direction.y === -1) player.direction.y = 0; break;
                case 's': if (player.direction.y === 1) player.direction.y = 0; break;
                case 'a': if (player.direction.x === -1) player.direction.x = 0; break;
                case 'd': if (player.direction.x === 1) player.direction.x = 0; break;
                case 'Shift': player.isRunning = false; break;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            gameState.player.angle = Math.atan2(
                mouseY - (gameState.player.y + gameState.player.height / 2),
                mouseX - (gameState.player.x + gameState.player.width / 2)
            );
        });

        canvas.addEventListener('click', (e) => {
            if (gameState.shopOpen) return;
            
            const weapon = gameState.inventory[gameState.selectedSlot];
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            if (weapon.type === 'knife') {
                gameState.player.meleeAttack();
            } else if (weapon.type === 'pistol' && weapon.ammo > 0 && gameState.pistolCooldown <= 0) {
                const player = gameState.player;
                // Calcula a posi√ß√£o do cano da pistola
                const barrelX = player.x + player.width / 2 + Math.cos(player.angle) * 35;
                const barrelY = player.y + player.height / 2 + Math.sin(player.angle) * 35;
                
                gameState.bullets.push(new Bullet(
                    barrelX,
                    barrelY,
                    player.angle,
                    'pistol'
                ));
                weapon.ammo--;
                gameState.pistolCooldown = 30; // 0.5 segundos (60 fps * 0.5)
                updateInventoryUI();
            } else if (weapon.type === 'shotgun' && weapon.ammo > 0 && gameState.shotgunCooldown <= 0) {
                const player = gameState.player;
                // Calcula a posi√ß√£o do cano da shotgun
                const barrelX = player.x + player.width / 2 + Math.cos(player.angle) * 40;
                const barrelY = player.y + player.height / 2 + Math.sin(player.angle) * 40;
                
                // Atira 5 proj√©teis em leque
                for (let i = 0; i < 5; i++) {
                    const spread = (i - 2) * Math.PI / 16; // Leque mais amplo
                    gameState.bullets.push(new Bullet(
                        barrelX,
                        barrelY,
                        player.angle + spread,
                        'shotgun'
                    ));
                }
                weapon.ammo--;
                gameState.shotgunCooldown = 60; // 1 segundo (60 fps * 1)
                updateInventoryUI();
            } else if (weapon.type === 'medkit') {
                gameState.player.useMedkit();
            } else if (weapon.type === 'grenade') {
                gameState.player.throwGrenade(mouseX, mouseY);
            } else if (weapon.type === 'laserRifle' && weapon.ammo > 0) {
                if (gameState.player.fireLaserRifle(mouseX, mouseY)) {
                    weapon.ammo--;
                    updateInventoryUI();
                }
            }
        });
        
        function reloadWeapon() {
            const weapon = gameState.inventory[gameState.selectedSlot];
            
            if (weapon.type === 'pistol') {
                // Verifica se tem muni√ß√£o no invent√°rio
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'pistolAmmo' && gameState.inventory[i].ammo > 0) {
                        const ammoNeeded = 12 - weapon.ammo;
                        const ammoTaken = Math.min(ammoNeeded, gameState.inventory[i].ammo);
                        
                        weapon.ammo += ammoTaken;
                        gameState.inventory[i].ammo -= ammoTaken;
                        
                        if (gameState.inventory[i].ammo <= 0) {
                            gameState.inventory[i] = { type: 'empty', ammo: null };
                        }
                        
                        updateInventoryUI();
                        break;
                    }
                }
            } else if (weapon.type === 'shotgun') {
                // Verifica se tem muni√ß√£o no invent√°rio
                for (let i = 0; i < gameState.inventory.length; i++) {
                    if (gameState.inventory[i].type === 'shotgunAmmo' && gameState.inventory[i].ammo > 0) {
                        const ammoNeeded = 5 - weapon.ammo;
                        const ammoTaken = Math.min(ammoNeeded, gameState.inventory[i].ammo);
                        
                        weapon.ammo += ammoTaken;
                        gameState.inventory[i].ammo -= ammoTaken;
                        
                        if (gameState.inventory[i].ammo <= 0) {
                            gameState.inventory[i] = { type: 'empty', ammo: null };
                        }
                        
                        updateInventoryUI();
                        break;
                    }
                }
            }
        }

        // Fun√ß√£o auxiliar para normalizar √¢ngulos
        function normalizeAngle(angle) {
            while (angle > Math.PI) angle -= Math.PI * 2;
            while (angle < -Math.PI) angle += Math.PI * 2;
            return angle;
        }

        // Bot√µes de in√≠cio/rein√≠cio
        document.getElementById('startButton').addEventListener('click', () => {
            document.getElementById('startScreen').style.display = 'none';
            initGame();
        });

        document.getElementById('restartButton').addEventListener('click', () => {
            document.getElementById('gameOverScreen').style.display = 'none';
            initGame();
        });

        // Bot√µes da loja
        document.getElementById('buyAmmo').addEventListener('click', buyAmmo);
        document.getElementById('buyShotgunAmmo').addEventListener('click', buyShotgunAmmo);
        document.getElementById('buyHealth').addEventListener('click', buyHealth);
        document.getElementById('buyDamage').addEventListener('click', buyDamage);
        document.getElementById('buySpeed').addEventListener('click', buySpeed);
        document.getElementById('buyMedkit').addEventListener('click', buyMedkit);
        document.getElementById('buyGrenades').addEventListener('click', buyGrenades);
        document.getElementById('closeShop').addEventListener('click', closeShop);

        // Efeito de sangue
        document.getElementById('bloodOverlay').style.background = 
            'radial-gradient(circle, rgba(255,0,0,0.7) 0%, rgba(255,0,0,0) 70%)';
    </script>
</body>
</html>